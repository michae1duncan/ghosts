{"ts":1353013583270,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"dojo.require(\"esri.map\");\r\ndojo.require(\"esri.dijit.Legend\");\r\ndojo.require(\"esri.dijit.Scalebar\");\r\ndojo.require(\"esri.arcgis.utils\");\r\ndojo.require(\"esri.IdentityManager\");\r\ndojo.require(\"dijit.dijit\"); // optimize: load dijit layer\r\ndojo.require(\"dijit.layout.BorderContainer\");\r\ndojo.require(\"dijit.layout.ContentPane\");\r\n\r\nvar urlObject,\r\n    map,\r\n    section = 0,\r\n    popup,\r\n    setPopup = true,\r\n    iPad = false,\r\n    seasonExtent;\r\n\r\nvar findLayerName = function(name){\r\n    var layerName;\r\n    dojo.forEach(map.layerIds,function(lyr){\r\n        if(lyr.search(name) !== -1){\r\n            layerName = lyr;\r\n        }\r\n    });\r\n    dojo.forEach(map.graphicsLayerIds,function(lyr){\r\n        if(lyr.search(name) !== -1){\r\n            layerName = lyr;\r\n        }\r\n    });\r\n    return layerName;\r\n};\r\n\r\nvar initMap = function(){\r\n\r\n    if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\r\n        configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\r\n    }\r\n    esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);\r\n\r\n    if(!configOptions.sharingurl){\r\n        configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\r\n    }\r\n    esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\r\n\r\n    urlObject = esri.urlToObject(document.location.href);\r\n    urlObject.query = urlObject.query || {};\r\n\r\n    if(urlObject.query.season){\r\n        if(urlObject.query.season.toLowerCase() === \"summer\"){\r\n            section = 1;\r\n        }\r\n        else if(urlObject.query.season.toLowerCase() === \"fall\"){\r\n            section = 2;\r\n        }\r\n        else if(urlObject.query.season.toLowerCase() === \"winter\"){\r\n            section = 3;\r\n        }\r\n        else if(urlObject.query.season.toLowerCase() === \"spring\"){\r\n            section = 4;\r\n        }\r\n        else{\r\n            section = 0;\r\n        }\r\n    }\r\n\r\n    createMap();\r\n\r\n    $(\"title\").html(configOptions.title);\r\n    $(\"#title\").html(configOptions.title);\r\n    $(\"#subtitle\").html(configOptions.subtitle);\r\n\r\n};\r\n\r\nvar createMap = function(){\r\n\r\n    var lods = [\r\n      \t{\"level\" : 0, \"resolution\" : 9783.93962049996, \"scale\" : 36978595.474472},\r\n  \t\t{\"level\" : 1, \"resolution\" : 4891.96981024998, \"scale\" : 18489297.737236},\r\n        {\"level\" : 2, \"resolution\" : 2445.98490512499, \"scale\" : 9244648.868618},\r\n        {\"level\" : 3, \"resolution\" : 1222.99245256249, \"scale\" : 4622324.434309},\r\n      \t{\"level\" : 4, \"resolution\" : 611.49622628138, \"scale\" : 2311162.217155},\r\n        {\"level\" : 5, \"resolution\" : 305.748113140558, \"scale\" : 1155581.108577}\r\n    ];\r\n\r\n    popup = new esri.dijit.Popup({\r\n        highlight:false\r\n    }, dojo.create(\"div\"));\r\n\r\n    var mapDeferred = esri.arcgis.utils.createMap(configOptions.webmap,\"map\",{\r\n        mapOptions: {\r\n            slider : false,\r\n            nav : false,\r\n            wrapAround180 : true,\r\n            infoWindow : popup,\r\n            lods : lods\r\n        },\r\n        ignorePopups:true\r\n    });\r\n\r\n    mapDeferred.addCallback(function(response){\r\n        map = response.map;\r\n\r\n        dojo.connect(dijit.byId(\"map\"),\"resize\",map,map.resize);\r\n\r\n        dojo.connect(map.getLayer(findLayerName(\"csv\")),\"onMouseOver\",function(event){\r\n            if(iPad === false){\r\n                map.setCursor(\"pointer\");\r\n                $(\"#hoverInfo\").html(event.graphic.attributes.Site_title);\r\n                positionInfo(event.graphic.geometry,$(\"#hoverInfo\"),$(\"#hoverInfoArrow\"));\r\n            }\r\n            else{\r\n                $(\".contentSlide\").each(function(){\r\n                    if($(this).children(\".titleBar\").children(\"tbody\").children(\"tr\").children(\".popupTitle\").html() === event.graphic.attributes.Point_name){\r\n                        $(\".contentSlide\").removeClass(\"currentSlide\");\r\n                        $(this).addClass(\"currentSlide\");\r\n                        $(\"#contentSlider\").animate({\r\n                            \"left\" : -$(\".currentSlide\").position().left\r\n                        },\"fast\");\r\n                        map.centerAndZoom(event.graphic.geometry,3);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        dojo.connect(map.getLayer(findLayerName(\"csv\")),\"onMouseOut\",function(event){\r\n            map.setCursor(\"default\");\r\n            hideInfo($(\"#hoverInfo\"),$(\"#hoverInfoArrow\"));\r\n        });\r\n\r\n        dojo.connect(map.getLayer(findLayerName(\"csv\")),\"onClick\",function(event){\r\n            if(iPad === false){\r\n                $(\".contentSlide\").each(function(){\r\n                    if($(this).children(\".titleBar\").children(\"tbody\").children(\"tr\").children(\".popupTitle\").html() === event.graphic.attributes.Point_name){\r\n                        $(\".contentSlide\").removeClass(\"currentSlide\");\r\n                        $(this).addClass(\"currentSlide\");\r\n                        $(\"#contentSlider\").animate({\r\n                            \"left\" : -$(\".currentSlide\").position().left\r\n                        },\"fast\");\r\n                        map.centerAndZoom(event.graphic.geometry,3);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        dojo.connect(map,\"onPanStart\",function(){\r\n            hideInfo($(\"#hoverInfoSlide\"),$(\"#hoverInfoArrowSlide\"));\r\n            hideInfo($(\"#hoverInfo\"),$(\"#hoverInfoArrow\"));\r\n        });\r\n\r\n        dojo.connect(map,\"onZoomStart\",function(){\r\n            hideInfo($(\"#hoverInfoSlide\"),$(\"#hoverInfoArrowSlide\"));\r\n            hideInfo($(\"#hoverInfo\"),$(\"#hoverInfoArrow\"));\r\n        });\r\n\r\n        dojo.connect(map,\"onExtentChange\",function(){\r\n            var title = $(\".currentSlide\").children(\".titleBar\").children(\"tbody\").children(\"tr\").children(\".popupTitle\").html();\r\n            dojo.forEach(map.getLayer(findLayerName(\"csv\")).graphics,function(grp){\r\n                if (grp.attributes.Point_name === title){\r\n                    $(\"#hoverInfoSlide\").html(grp.attributes.Site_title);\r\n                    positionInfo(grp.geometry,$(\"#hoverInfoSlide\"),$(\"#hoverInfoArrowSlide\"));\r\n                }\r\n            });\r\n            if($(\".currentSlide\").first().hasClass(\"popupSlide\")){\r\n                $(\".popup.fader\").imageFader(\"pause\");\r\n                $(\".currentSlide\").first().children(\".fader\").first().imageFader(\"play\");\r\n            }\r\n        });\r\n\r\n        dojo.connect(map,\"onUpdateEnd\",function(){\r\n            $(\"#loadingModal\").fadeOut();\r\n            $(\"#thumbnail\").hide();\r\n        });\r\n\r\n        var layers = response.itemInfo.itemData.operationalLayers;\r\n\r\n        if(map.loaded){\r\n            initUI(layers);\r\n            setSection(section);\r\n            changeSidePanel();\r\n            $(\"#zoomToggle\").show();\r\n        }\r\n        else{\r\n            dojo.connect(map,\"onLoad\",function(){\r\n                initUI(layers);\r\n                setSection(section);\r\n                changeSidePanel();\r\n                $(\"#zoomToggle\").show();\r\n            });\r\n        }\r\n\r\n    });\r\n    mapDeferred.addErrback(function(error) {\r\n        console.log(\"Map creation failed: \", dojo.toJson(error));\r\n    });\r\n\r\n    dojo.connect(popup,\"onSetFeatures\",function(){\r\n        if(section !== 0){\r\n            var newFtr = [];\r\n            dojo.forEach(popup.features,function(ftr){\r\n                if(ftr.attributes.Season === section){\r\n                    newFtr.push(ftr);\r\n                }\r\n            });\r\n            if (setPopup === true){\r\n                setPopup = false;\r\n                popup.setFeatures(newFtr);\r\n            }\r\n            else{\r\n                setPopup = true;\r\n            }\r\n        }\r\n        else{\r\n            //$(\".actionList\").html(\"<p id='seasonButton'>Go to \"+popup.features[0].attributes.Season+\"</p>\");\r\n        }\r\n    });\r\n\r\n};\r\n\r\n\r\nfunction initUI(layers) {\r\n\r\n    var layerInfo = buildLayersList(layers);\r\n\r\n    /*\r\n    if(layerInfo.length > 0){\r\n    \tvar legendDijit = new esri.dijit.Legend({\r\n\t\t\tmap:map,\r\n\t\t\tlayerInfos:layerInfo\r\n\t\t},\"legendContent\");\r\n        legendDijit.startup();\r\n    }\r\n    else{\r\n        dojo.byId(\"legendContent\").innerHTML = \"\";\r\n    }\r\n    */\r\n}\r\n\r\nfunction buildLayersList(layers){\r\n        //layers  arg is  response.itemInfo.itemData.operationalLayers;\r\n        var layerInfos = [];\r\n        dojo.forEach(layers, function(mapLayer, index){\r\n          var layerInfo = {};\r\n          if (mapLayer.featureCollection && mapLayer.type !== \"CSV\") {\r\n            if (mapLayer.featureCollection.showLegend === true) {\r\n              dojo.forEach(mapLayer.featureCollection.layers, function(fcMapLayer){\r\n                if (fcMapLayer.showLegend !== false) {\r\n                  layerInfo = {\r\n                    \"layer\": fcMapLayer.layerObject,\r\n                    \"title\": mapLayer.title,\r\n                    \"defaultSymbol\": false\r\n                  };\r\n                  if (mapLayer.featureCollection.layers.length > 1) {\r\n                    layerInfo.title += \" - \" + fcMapLayer.layerDefinition.name;\r\n                  }\r\n                  layerInfos.push(layerInfo);\r\n                }\r\n              });\r\n            }\r\n          } else if (mapLayer.showLegend !== false) {\r\n            layerInfo = {\r\n              \"layer\": mapLayer.layerObject,\r\n              \"title\": mapLayer.title,\r\n              \"defaultSymbol\": false\r\n            };\r\n            //does it have layers too? If so check to see if showLegend is false\r\n            if (mapLayer.layers) {\r\n              var hideLayers = dojo.map(dojo.filter(mapLayer.layers, function(lyr){\r\n                return (lyr.showLegend === false);\r\n              }), function(lyr){\r\n                return lyr.id\r\n              });\r\n              if (hideLayers.length) {\r\n                layerInfo.hideLayers = hideLayers;\r\n              }\r\n            }\r\n            layerInfos.push(layerInfo);\r\n          }\r\n        });\r\n        return layerInfos;\r\n      }"]],"start1":0,"start2":0,"length1":0,"length2":9935}]],"length":9935}
{"contributors":[],"silentsave":true,"ts":1357853276076,"patch":[[{"diffs":[[0,"    "],[-1,"}\r\n        else{\r\n            dojo.connect(map,\"onLoad\",function(){\r\n                initUI(layers);\r\n                setSection(section);\r\n                changeSidePanel();\r\n                $(\"#zoomToggle\").show("],[1,"    dojo.forEach(map.getLayer(map.graphicsLayerIds[0]).graphics,function(g){\r\n                if(g.attributes.Site_title === \"Tigertail Beach, FL\"){\r\n                    g.attributes.Site_title = \"Tigertail Lagoon and Sand Dollar Island\";\r\n                }\r\n                if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                    g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                }\r\n            });\r\n        }\r\n        else{\r\n            dojo.connect(map,\"onLoad\",function(){\r\n                initUI(layers);\r\n                setSection(section);\r\n                changeSidePanel();\r\n                $(\"#zoomToggle\").show();\r\n                dojo.forEach(map.getLayer(map.graphicsLayerIds[0]).graphics,function(g){\r\n                    if(g.attributes.Site_title === \"Tigertail Beach, FL\"){\r\n                        g.attributes.Site_title = \"Tigertail Lagoon and Sand Dollar Island, FL\";\r\n                    }\r\n                    if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                        alert\r\n                        g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                    }\r\n                }"],[0,");\r\n"]],"start1":6774,"start2":6774,"length1":222,"length2":1185}]],"length":10898,"saved":false}
{"ts":1357853283614,"patch":[[{"diffs":[[0,"   alert"],[1,"(g.attributes.Photo_1_credit)"],[0,"\r\n      "]],"start1":7833,"start2":7833,"length1":16,"length2":45}]],"length":10927,"saved":false}
{"ts":1357853285056,"patch":[[{"diffs":[[0,"_credit)"],[1,";"],[0,"\r\n      "]],"start1":7862,"start2":7862,"length1":16,"length2":17}]],"length":10928,"saved":false}
{"ts":1357853291658,"patch":[[{"diffs":[[0," Island, FL\"){\r\n"],[1,"                    alert(g.attributes.Photo_1_credit);\r\n"],[0,"                "]],"start1":7098,"start2":7098,"length1":32,"length2":89}]],"length":10985,"saved":false}
{"ts":1357853317587,"patch":[[{"diffs":[[0," }\r\n"],[-1,"                if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                    alert(g.attributes.Photo_1_credit);\r\n                    g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                }\r\n"],[0,"    "]],"start1":7033,"start2":7033,"length1":229,"length2":8}]],"length":10764,"saved":false}
{"ts":1357853319988,"patch":[[{"diffs":[[0,"s,function(g){\r\n"],[1,"                if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                    alert(g.attributes.Photo_1_credit);\r\n                    g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                }\r\n"],[0,"                "]],"start1":6840,"start2":6840,"length1":32,"length2":253}]],"length":10985,"saved":false}
{"ts":1357853323004,"patch":[[{"diffs":[[0,"){\r\n"],[-1,"                    alert(g.attributes.Photo_1_credit);\r\n"],[0,"    "]],"start1":6929,"start2":6929,"length1":65,"length2":8}]],"length":10928,"saved":false}
{"ts":1357853325878,"patch":[[{"diffs":[[0,"){\r\n"],[-1,"                        alert(g.attributes.Photo_1_credit);\r\n"],[0,"    "]],"start1":7808,"start2":7808,"length1":69,"length2":8}]],"length":10867,"saved":false}
{"ts":1357853328298,"patch":[[{"diffs":[[0," }\r\n"],[-1,"                    if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                        g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                    }\r\n"],[0,"    "]],"start1":7727,"start2":7727,"length1":184,"length2":8}]],"length":10691,"saved":false}
{"ts":1357853330593,"patch":[[{"diffs":[[0,"s,function(g){\r\n"],[1,"                    if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                        g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                    }\r\n"],[0,"                "]],"start1":7518,"start2":7518,"length1":32,"length2":208}]],"length":10867,"saved":false}
{"ts":1357853372520,"patch":[[{"diffs":[[0,"){\r\n"],[-1,"                    if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                        g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                    }\r\n"],[0,"    "]],"start1":7530,"start2":7530,"length1":184,"length2":8}]],"length":10691,"saved":false}
{"ts":1357853376418,"patch":[[{"diffs":[[0,"){\r\n"],[-1,"                if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                    g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                }\r\n"],[0,"    "]],"start1":6852,"start2":6852,"length1":172,"length2":8}]],"length":10527,"saved":false}
{"ts":1357853441137,"patch":[[{"diffs":[[0,"s,function(g){\r\n"],[1,"                if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                    g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                }\r\n"],[0,"                "]],"start1":6840,"start2":6840,"length1":32,"length2":196}]],"length":10691,"saved":false}
{"ts":1357853442839,"patch":[[{"diffs":[[0,"s,function(g){\r\n"],[1,"                    if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                        g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                    }\r\n"],[0,"                "]],"start1":7518,"start2":7518,"length1":32,"length2":208}]],"length":10867,"saved":false}
{"ts":1357853454835,"patch":[[{"diffs":[[0," Island, FL\"){\r\n"],[1,"                    alert(g.attributes.Photo_1_credit);\r\n"],[0,"                "]],"start1":6917,"start2":6917,"length1":32,"length2":89},{"diffs":[[0,"le === \""],[-1,"Little Talbot Island"],[1,"Tigertail Beach"],[0,", FL\"){\r"]],"start1":7635,"start2":7635,"length1":36,"length2":31},{"diffs":[[0,"tes."],[-1,"Photo_1_credit = \"Walker Golder"],[1,"Site_title = \"Tigertail Lagoon and Sand Dollar Island, FL"],[0,"\";\r\n"]],"start1":7700,"start2":7700,"length1":39,"length2":65},{"diffs":[[0,"_title === \""],[-1,"Tigertail Beach"],[1,"Little Talbot Island"],[0,", FL\"){\r\n   "]],"start1":7828,"start2":7828,"length1":39,"length2":44},{"diffs":[[0,"                "],[1,"alert("],[0,"g.attributes.Sit"]],"start1":7877,"start2":7877,"length1":32,"length2":38},{"diffs":[[0,"tes."],[-1,"Site_title = \"Tigertail Lagoon and Sand Dollar Island, FL"],[1,"Photo_1_credit);\r\n                        g.attributes.Photo_1_credit = \"Walker Golder"],[0,"\";\r\n"]],"start1":7908,"start2":7908,"length1":65,"length2":94}]],"length":10985,"saved":false}
{"ts":1357853457465,"patch":[[{"diffs":[[0,"){\r\n"],[-1,"                    alert(g.attributes.Photo_1_credit);\r\n"],[0,"    "]],"start1":6929,"start2":6929,"length1":65,"length2":8}]],"length":10928,"saved":false}
{"ts":1357853458766,"patch":[[{"diffs":[[0,"){\r\n"],[-1,"                        alert(g.attributes.Photo_1_credit);\r\n"],[0,"    "]],"start1":7808,"start2":7808,"length1":69,"length2":8}]],"length":10867,"saved":false}
{"ts":1357853466895,"patch":[[{"diffs":[[0," }\r\n"],[-1,"                    if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                        g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                    }\r\n"],[0,"    "]],"start1":7727,"start2":7727,"length1":184,"length2":8}]],"length":10691,"saved":false}
{"ts":1357853468264,"patch":[[{"diffs":[[0,"s,function(g){\r\n"],[1,"                    if(g.attributes.Site_title === \"Little Talbot Island, FL\"){\r\n                        g.attributes.Photo_1_credit = \"Walker Golder\";\r\n                    }\r\n"],[0,"                "]],"start1":7518,"start2":7518,"length1":32,"length2":208}]],"length":10867,"saved":false}
{"ts":1357853493075,"patch":[[{"diffs":[[0,"r Island"],[1,", "],[0,"\";\r\n    "]],"start1":7170,"start2":7170,"length1":16,"length2":18}]],"length":10869,"saved":false}
{"ts":1357853494216,"patch":[[{"diffs":[[0,"Island, "],[1,"FL"],[0,"\";\r\n    "]],"start1":7172,"start2":7172,"length1":16,"length2":18}]],"length":10871,"saved":false}
